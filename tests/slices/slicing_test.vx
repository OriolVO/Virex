import "io.vx";

func test_array_slicing() -> i32 {
    var [5]i32 arr;
    arr[0] = 10;
    arr[1] = 20;
    arr[2] = 30;
    arr[3] = 40;
    arr[4] = 50;

    // Test 1: Explicit start and end
    var []i32 s1 = arr[1..3]; // should be [20, 30], len 2
    
    // Note: Implicit dereference of slices for .len / .data implemented in semantic.c
    if (s1.len != 2) {
        io.print("Error: s1.len != 2\n");
        return 1;
    }
    if (s1[0] != 20) {
        io.print("Error: s1[0] != 20\n");
        return 2;
    }
    io.print("✓ arr[1..3] passed\n");

    // Test 2: Implicit end
    var []i32 s2 = arr[3..]; // should be [40, 50], len 2
    if (s2.len != 2) {
        io.print("Error: s2.len != 2\n");
        return 4;
    }
    if (s2[0] != 40) {
        io.print("Error: s2[0] != 40\n");
        return 5;
    }
    io.print("✓ arr[3..] passed\n");
    
    // Test 3: Implicit start
    var []i32 s3 = arr[..2]; // should be [10, 20]
    if (s3.len != 2) {
        io.print("Error: s3.len != 2\n");
        return 6;
    }
    if (s3[0] != 10) {
        io.print("Error: s3[0] != 10\n");
        return 7;
    }
    io.print("✓ arr[..2] passed\n");
    
    // Test 4: Full slice
    var []i32 s4 = arr[..];
    if (s4.len != 5) {
        io.print("Error: s4.len != 5\n");
        return 8;
    }
    io.print("✓ arr[..] passed\n");
    
    return 0;   
}

func main() -> i32 {
    io.print("=== Slicing Tests ===\n");
    // Currently segfaults during compilation of AST_SLICE_EXPR due to heap corruption
    if (test_array_slicing() != 0) return 1;
    
    io.print("=== All Slicing Tests Passed ===\n");
    return 0;
}
