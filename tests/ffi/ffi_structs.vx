module "ffi_structs_test";

import "io.vx";

struct Point {
    i32 x;
    i32 y;
};

extern func print_point(Point p);
extern func offset_point(Point p, i32 dx, i32 dy) -> Point;

func main() -> i32 {
    var Point p;
    p.x = 10;
    p.y = 20;
    
    io.print("Virex calling C print_point:"); io.print("\n");
    unsafe {
        print_point(p);
    }
    
    io.print("Virex calling C offset_point:"); io.print("\n");
    var Point p2;
    unsafe {
        p2 = offset_point(p, 5, 5);
    }
    
    io.print("p2.x: ");
    io.print(p2.x); io.print("\n");
    io.print("p2.y: ");
    io.print(p2.y); io.print("\n");
    
    if (p2.x == 15 && p2.y == 25) {
        io.print("FFI structs test passed!"); io.print("\n");
        return 0;
    }
    
    io.print("FFI structs test failed!"); io.print("\n");
    return 1;
}
