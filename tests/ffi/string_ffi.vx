module "string_ffi_test";

import "std/ffi.vx";
import "io.vx";

extern func strlen(u8* s) -> u64;
extern func strcmp(u8* s1, u8* s2) -> i32;

func main() -> i32 {
    var []u8 s1 = "hello";
    var []u8 s2 = "world";
    var []u8 s3 = "hello";

    io.print("Testing string FFI (strlen/strcmp):"); io.print("\n");

    var i32 len1 = 0;
    unsafe {
        len1 = strlen(s1);
    }
    io.print("Length of 'hello': ");
    io.print(len1); io.print("\n");

    var i32 cmp1 = 0;
    unsafe {
        cmp1 = strcmp(s1, s2);
    }
    io.print("strcmp('hello', 'world'): ");
    io.print(cmp1); io.print("\n");

    var i32 cmp2 = 0;
    unsafe {
        cmp2 = strcmp(s1, s3);
    }
    io.print("strcmp('hello', 'hello'): ");
    io.print(cmp2); io.print("\n");

    if (len1 == 5 && cmp1 != 0 && cmp2 == 0) {
        io.print("String FFI tests passed!"); io.print("\n");
        return 0;
    } else {
        io.print("String FFI tests failed!"); io.print("\n");
        return 1;
    }
}
